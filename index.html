<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìã ŸÜÿ∏ÿßŸÖ ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖÿ¥ÿßÿ±Ÿäÿπ</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    
    <style>
        /* üé® ÿßŸÑÿ™ŸÜÿ≥ŸäŸÇÿßÿ™ ÿßŸÑÿπÿßŸÖÿ© ŸàÿßŸÑŸÖÿ≠ÿ≥ŸëŸÜÿ© */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Cairo', sans-serif;
            background: linear-gradient(135deg, #1f1f2e, #12121c);
            color: #e0e0e0;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
            direction: rtl;
            scroll-behavior: smooth;
            transition: background 0.5s ease, color 0.5s ease;
        }
        /* üåô Ÿàÿ∂ÿπ ÿßŸÑÿ•ÿ∂ÿßÿ°ÿ© (Light Mode) */
        body.light-mode {
            background: #f0f0f0;
            color: #111;
        }
        body.light-mode .container {
            background: #ffffff;
            border: 1px solid #ccc;
            color: #111;
        }
        body.light-mode h1, body.light-mode h2, body.light-mode h3 {
            color: #2193b0;
            -webkit-text-fill-color: #2193b0;
        }
        body.light-mode button {
            background: linear-gradient(135deg, #00b09b, #96c93d);
            color: #fff;
        }
        body.light-mode button.delete {
            background: #e74c3c;
        }
        body.light-mode .project, body.light-mode .day {
            background: #e6f4ea;
            border: 1px solid #28a745;
            color: #155724;
        }
        body.light-mode .project:hover, body.light-mode .day:hover {
            background: #d4e9da;
        }
        body.light-mode input, body.light-mode textarea {
            background-color: #fff;
            color: #000;
            border-color: #bbb;
        }
        /* ÿ≤ÿ± ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑŸàÿ∂ÿπ (Mode Toggle) */
        .theme-toggle {
            background: none;
            color: #e0e0e0;
            font-size: 1.5rem;
            width: 40px; /* ÿ™ÿ≠ÿØŸäÿØ ÿπÿ±ÿ∂ ÿ´ÿßÿ®ÿ™ */
            height: 40px; /* ÿ™ÿ≠ÿØŸäÿØ ÿßÿ±ÿ™ŸÅÿßÿπ ÿ´ÿßÿ®ÿ™ */
            border-radius: 50%; /* ÿ¨ÿπŸÑŸá ÿØÿßÿ¶ÿ±ŸäŸãÿß */
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: none;
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1000;
            transition: color 0.3s, background 0.3s;
        }
        body.light-mode .theme-toggle {
            color: #2c3e50;
        }
        /* ÿµŸÜÿØŸàŸÇ ÿßŸÑŸÉŸàŸÜÿ™ŸäŸÜÿ± */
        .container {
            background: rgba(40, 44, 52, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(6px);
            padding: 40px 35px;
            border-radius: 20px;
            box-shadow: 0 12px 35px rgba(0, 0, 0, 0.4);
            width: 95%;
            max-width: 850px;
            transition: transform 0.4s ease, box-shadow 0.4s ease;
            animation: fadeInUp 0.6s ease-out;
            margin-top: 80px;
        }
        .container:hover {
            transform: scale(1.005);
            box-shadow: 0 14px 40px rgba(0, 0, 0, 0.5);
        }
        /* ÿßŸÑÿπŸÜŸàÿßŸÜ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿä */
        h1 {
            color: #ffffff;
            font-size: 36px;
            margin-bottom: 25px;
            background: linear-gradient(to right, #6dd5ed, #2193b0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-align: center;
        }
        h2, h3 {
            color: #ffffff;
            background: linear-gradient(to right, #6dd5ed, #2193b0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-size: 1.5rem;
            margin-top: 0;
        }
        /* ÿßŸÑÿ£ÿ≤ÿ±ÿßÿ± */
        button {
            background: linear-gradient(135deg, #00b09b, #96c93d);
            color: #fff;
            padding: 14px 28px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
            margin-right: 5px;
            box-shadow: 0 5px 16px rgba(0, 255, 180, 0.3);
        }
        button:hover {
            background: linear-gradient(135deg, #00816a, #7db515);
            box-shadow: 0 8px 22px rgba(0, 255, 180, 0.4);
            transform: translateY(-1px);
        }
        button.delete {
            background: #e74c3c;
            box-shadow: 0 5px 16px rgba(231, 76, 60, 0.3);
        }
        button.delete:hover {
            background: #c0392b;
            box-shadow: 0 8px 22px rgba(231, 76, 60, 0.4);
        }
        button.back {
            background: linear-gradient(135deg, #8e44ad, #9b59b6);
            box-shadow: 0 5px 16px rgba(155, 89, 182, 0.3);
        }
        button.back:hover {
            background: linear-gradient(135deg, #6c3483, #8e44ad);
        }
        .project, .day {
            padding: 15px;
            background: #282c34;
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 14px;
            margin: 10px 0;
            transition: background 0.3s;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .project:hover, .day:hover {
            background: #343a40;
            cursor: pointer;
        }
        .progress-bar {
            background: #1d1f27;
            border-radius: 8px;
            height: 25px;
            margin: 15px 0;
            overflow: hidden;
        }
        .progress {
            background: linear-gradient(to right, #00b09b, #96c93d);
            height: 100%;
            border-radius: 8px;
            width: 0%;
            color: white;
            text-align: center;
            line-height: 25px;
            font-size: 14px;
            transition: width 0.5s ease-in-out;
        }
        .hidden {
            display: none;
        }
        input, textarea {
            width: 100%;
            padding: 12px;
            margin: 8px 0;
            border-radius: 10px;
            border: 1px solid #444;
            background-color: #1d1f27;
            color: #fff;
            font-size: 1rem;
            box-sizing: border-box;
        }
        input:focus, textarea:focus {
            border-color: #6dd5ed;
            outline: none;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            font-size: 0.9rem;
            overflow-x: auto;
            display: block;
        }
        th, td {
            border: 1px solid #444;
            padding: 10px;
            text-align: right;
            white-space: nowrap;
        }
        th {
            background: #1d1f27;
            color: #e0e0e0;
        }
        .flex-between {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }
        .day-details {
            margin-top: 15px;
            display: none;
            background: #22262b;
            padding: 10px;
            border-radius: 8px;
        }
        img, video {
            max-width: 100px;
            max-height: 100px;
            border-radius: 8px;
            margin: 5px;
            cursor: pointer;
            border: 2px solid #ddd;
            transition: transform 0.2s, border-color 0.2s;
        }
        img:hover, video:hover {
            transform: scale(1.05);
            border-color: #3498db;
        }
        .fullscreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .fullscreen img, .fullscreen video {
            max-width: 90%;
            max-height: 90%;
            border-radius: 0;
        }
        #searchInput, #searchDayInput {
            padding: 12px;
            width: 100%;
            margin-bottom: 15px;
        }
        /* Auth Page Styles */
        .auth-container {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 400px;
            text-align: center;
            color: #333;
            margin-top: 50px;
        }
        .icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: #667eea;
        }
        .auth-container h1 {
            color: #333;
            margin-bottom: 2rem;
            font-size: 1.5rem;
            background: none;
            -webkit-text-fill-color: #333;
        }
        .form-group {
            margin-bottom: 1.5rem;
            text-align: right;
        }
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: #555;
            font-weight: 500;
        }
        .form-group input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
            text-align: right;
            background: white;
            color: #333;
        }
        .form-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        .button-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 2rem;
        }
        .btn-primary {
            background: #667eea;
            color: white;
            flex: 1;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        .btn-primary:hover {
            background: #5a67d8;
            transform: translateY(-2px);
        }
        .btn-secondary {
            background: #f7f7f7;
            color: #333;
            border: 2px solid #ddd;
            flex: 1;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        .btn-secondary:hover {
            background: #e7e7e7;
            transform: translateY(-2px);
        }
        .btn-google {
            background: #4285f4;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: 100%;
            border: none;
        }
        .btn-google:hover {
            background: #357ae8;
            transform: translateY(-2px);
        }
        .success-message {
            display: none;
            background: #d4edda;
            color: #155724;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            border: 1px solid #c3e6cb;
        }
        .error-message {
            display: none;
            background: #f8d7da;
            color: #721c24;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            border: 1px solid #f5c6cb;
        }
        .form-toggle {
            margin-top: 1rem;
            color: #666;
        }
        .form-toggle a {
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
        }
        .form-toggle a:hover {
            text-decoration: underline;
        }
        .user-info {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            text-align: right;
            color: #333;
        }
        .user-header {
            background: rgba(40, 44, 52, 0.95);
            color: #e0e0e0;
            padding: 10px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }
        body.light-mode .user-header {
            background: #ffffff;
            color: #333;
            border: 1px solid #ddd;
        }
        /* Developer Info Footer */
        .developer-info {
            margin-top: 40px;
            text-align: center;
            font-size: 0.9rem;
            color: #888;
            padding: 10px;
            border-top: 1px solid #333;
            width: 100%;
        }
        body.light-mode .developer-info {
            color: #555;
            border-top: 1px solid #ccc;
        }
        .developer-info a {
            color: #6dd5ed;
            text-decoration: none;
            transition: color 0.3s;
        }
        .developer-info a:hover {
            color: #2193b0;
            text-decoration: underline;
        }
        /* üì± ÿ™ŸÜÿ≥ŸäŸÇÿßÿ™ ÿßŸÑŸáŸàÿßÿ™ŸÅ (ÿ™ÿ¨ÿßŸàÿ®Ÿä) */
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-40px); }
            to { opacity: 1; transform: translateX(0); }
        }
        @media(max-width: 600px) and (orientation: portrait) {
            .flex-between {
                flex-direction: column;
                align-items: flex-start;
            }
            .button-group {
                display: flex;
                flex-direction: column;
                width: 100%;
            }
            .button-group button {
                width: 100%;
                margin: 8px 0;
            }
            button {
                width: 100%;
                margin: 8px 0;
            }
            .container {
                padding: 25px 20px;
                border-radius: 12px;
            }
            h1 {
                font-size: 26px;
            }
            .user-header {
                flex-direction: column;
                text-align: center;
                gap: 10px;
            }
            .theme-toggle {
                top: 10px;
                left: 10px;
                font-size: 1.2rem;
            }
        }
        #sharePage .flex-between,
        #sharePage .button-group {
            display: none !important;
        }

        /* ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑÿπÿ±ÿ∂ ÿπŸÑŸâ ÿßŸÑŸáŸàÿßÿ™ŸÅ */
        @media (max-width: 768px) {
            .container {
                padding: 15px 10px;
                margin-top: 40px;
            }

            h1 {
                font-size: 22px;
            }

            h2, h3 {
                font-size: 18px;
            }

            input, select, textarea, button {
                font-size: 0.9rem;
                padding: 8px 10px;
            }

            /* ŸäÿÆŸÑŸä ÿßŸÑÿ¨ÿØŸàŸÑ ŸäŸÑŸÅ ŸäŸÖŸäŸÜ ŸàŸäÿ≥ÿßÿ± */
            table {
                display: block;
                overflow-x: auto;
                white-space: nowrap;
            }

            th, td {
                font-size: 0.85rem;
                padding: 6px;
            }

            /* ŸäÿÆŸÑŸä ÿßŸÑÿ£ÿ≤ÿ±ÿßÿ± ÿ¨ŸÜÿ® ÿ®ÿπÿ∂ */
            .inline-buttons {
                flex-direction: column;
            }

            .inline-buttons button {
                width: 100%;
            }
        }
    </style>
</head>
<body>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/localforage/1.10.0/localforage.min.js"></script>

<div id="darkModeToggle" class="theme-toggle">
    <i class="fas fa-adjust"></i>
</div>

<div class="auth-container" id="authPage">
    <div class="icon">üìã</div>
    <h1 id="form-title">ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ</h1>
    
    <div id="success-msg" class="success-message"></div>
    <div id="error-msg" class="error-message"></div>

    <form id="auth-form">
        <div class="form-group">
            <label for="email">ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä:</label>
            <input type="email" id="email" name="email" placeholder="Your-Name@gmail.com" required>
        </div>

        <div class="form-group">
            <label for="password">ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±:</label>
            <input type="password" id="password" name="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
            <a href="#" style="font-size: 0.9rem; color: #667eea; text-decoration: underline; display: block; text-align: right; margin-top: 10px;" onclick="resetPassword(); return false;" id="forgot-password-link">ŸáŸÑ ŸÜÿ≥Ÿäÿ™ ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±ÿü</a>
        </div>

        <div class="form-group hidden" id="confirm-password-group">
            <label for="confirm-password">ÿ™ÿ£ŸÉŸäÿØ ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±:</label>
            <input type="password" id="confirm-password" name="confirm-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
        </div>

        <div class="button-group">
            <button type="button" id="login-btn" class="btn-primary">ÿ™ÿ≥ÿ¨ŸäŸÑ ÿØÿÆŸàŸÑ</button>
            <button type="button" id="signup-btn" class="btn-primary hidden">ÿ•ŸÜÿ¥ÿßÿ° ÿ≠ÿ≥ÿßÿ®</button>
        </div>
    </form>
    
    <!-- ÿ≤ÿ± ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ ÿ®ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ Google -->
    <div style="text-align: center; margin: 20px 0;">
        <div style="position: relative; margin: 20px 0;">
            <hr style="border: none; height: 1px; background: #ddd;">
            <span style="position: absolute; top: -10px; left: 50%; transform: translateX(-50%); background: white; padding: 0 15px; color: #888;">ÿ£Ÿà</span>
        </div>
        <button type="button" id="google-login-btn" class="btn-secondary btn-google">
            <svg width="20" height="20" viewBox="0 0 24 24">
                <path fill="white" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                <path fill="white" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                <path fill="white" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                <path fill="white" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
            </svg>
            ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ ÿ®ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ Google
        </button>
    </div>

    <div class="form-toggle">
        <p id="toggle-text">ŸÑŸäÿ≥ ŸÑÿØŸäŸÉ ÿ≠ÿ≥ÿßÿ®ÿü <a href="#" id="toggle-link">ÿ•ŸÜÿ¥ÿßÿ° ÿ≠ÿ≥ÿßÿ® ÿ¨ÿØŸäÿØ</a></p>
    </div>
</div>

<div class="container hidden" id="mainPage">
    <div class="user-header">
        <div>
            <h2 style="margin: 0;">ŸÖÿ±ÿ≠ÿ®ÿßŸãÿå <span id="user-display-name"></span>! üôã‚Äç‚ôÇÔ∏è</h2>
            <small id="user-display-email"></small>
        </div>
        <button id="logout-btn" class="btn-secondary" style="margin: 0;">ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨</button>
    </div>
    
    <h1>üìã ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖÿ¥ÿßÿ±Ÿäÿπ</h1>
    <input type="text" id="searchInput" placeholder="üîç ÿ®ÿ≠ÿ´ ÿπŸÜ ŸÖÿ¥ÿ±Ÿàÿπ..." onkeyup="searchProjects()">
    <div id="projectList"></div>
    <button onclick="showAddProject()">‚ûï ÿ•ÿ∂ÿßŸÅÿ© ŸÖÿ¥ÿ±Ÿàÿπ</button>
    <div id="addProjectForm" class="hidden">
        <input type="text" id="projectName" placeholder="ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ">
        <input type="number" id="projectDuration" placeholder="ŸÖÿØÿ© ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ (ÿ®ÿßŸÑÿ£ŸäÿßŸÖ)">
        <input type="number" id="projectCost" placeholder="ÿ™ŸÉŸÑŸÅÿ© ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ">
        <button onclick="addProject()">ÿ≠ŸÅÿ∏</button>
    </div>
</div>

<div class="container hidden" id="projectPage">
    <div class="flex-between">
        <button class="back" onclick="backToProjects()">‚¨Ö ÿ±ÿ¨Ÿàÿπ</button>
        <div class="button-group">
            <button onclick="editProject()">‚úè ÿ™ÿπÿØŸäŸÑ</button>
            <button class="delete" onclick="deleteProject()">üóë ÿ≠ÿ∞ŸÅ</button>
        </div>
    </div>
    <h2 id="projTitle"></h2>
    <div class="progress-bar"><div class="progress" id="projProgress"></div></div>
    <h3 id="daysLeft"></h3>
    <h3 id="projCost"></h3>

    <div id="paymentsSection">
        <h3>üíµ ÿßŸÑÿØŸÅÿπÿßÿ™</h3>
        <div id="paymentsList"></div>
        <button onclick="addPayment()">‚ûï ÿ•ÿ∂ÿßŸÅÿ© ÿØŸÅÿπÿ©</button>
        <h3 id="remainingCost"></h3>
    </div>

    <h2>üìÖ ÿßŸÑÿ£ŸäÿßŸÖ</h2>
    <input type="date" id="searchDayInput" onchange="searchDays()">
    <div id="daysList"></div>
    <button onclick="addDay()">‚ûï ÿ•ÿ∂ÿßŸÅÿ© ŸäŸàŸÖ</button>
    <br><br>
    <button onclick="shareProject()">üîó ŸÖÿ¥ÿßÿ±ŸÉÿ© (ÿπÿ±ÿ∂ ŸÅŸÇÿ∑)</button>
</div>

<div class="container hidden" id="dayPage">
    <button class="back" onclick="backToProject()">‚¨Ö ÿ±ÿ¨Ÿàÿπ ŸÑŸÑŸÖÿ¥ÿ±Ÿàÿπ</button>
    <h2 id="dayDate"></h2>
    <label>üî® ÿπŸÖŸÑ ÿßŸÑŸäŸàŸÖ</label>
    <textarea id="workDescription"></textarea>
    <label>üë∑ ÿßŸÑŸÉÿßÿØÿ±</label>
    <textarea id="workersDetail"></textarea>
    <label>üí∞ ÿßŸÑŸÖÿ®ÿßŸÑÿ∫</label>
    <textarea id="costDetail"></textarea>
    
    <h3>üì∏ ÿßŸÑÿµŸàÿ± </h3>
    <input type="file" id="mediaInput" multiple accept="image/*,video/*">
    <div id="mediaList"></div>
    <button onclick="saveDay()">üíæ ÿ≠ŸÅÿ∏ / ÿ™ÿπÿØŸäŸÑ</button>
</div>

<div class="container hidden" id="sharePage">
    <div class="flex-between">
        <button class="back" onclick="backToProjectPageFromShare()">‚¨Ö ÿ±ÿ¨Ÿàÿπ ŸÑŸÑŸÖÿ¥ÿ±Ÿàÿπ</button>
        <button class="back" onclick="backToProjects()">‚¨Ö ÿ±ÿ¨Ÿàÿπ ŸÑŸÑŸÇÿßÿ¶ŸÖÿ©</button>
    </div>
    <h2 id="shareProjTitle"></h2>
    <div class="progress-bar"><div class="progress" id="shareProjProgress"></div></div>
    <h3 id="shareDaysLeft"></h3>
    <h3 id="shareProjCost"></h3>
    <h3>üíµ ÿßŸÑÿØŸÅÿπÿßÿ™</h3>
    <div id="sharePaymentsList"></div>
    <h2>üìÖ ÿßŸÑÿ£ŸäÿßŸÖ</h2>
    <div id="shareDaysList"></div>
</div>

<div class="developer-info">
    <p>ÿ™ÿ∑ŸàŸäÿ±: ÿßŸÑŸÖŸáŸÜÿØÿ≥ ŸÉÿßÿ∏ŸÖ ŸÇÿßÿ≥ŸÖ</p>
    <p>ÿ±ŸÇŸÖ ÿßŸÑŸáÿßÿ™ŸÅ: <a href="tel:07746424814">07746424814</a></p>
</div>

<script>
    // ========== ŸÜÿ∏ÿßŸÖ ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖÿ¥ÿßÿ±Ÿäÿπ - JavaScript Code ==========
    
    // ** ÿßÿ≥ÿ™ÿ®ÿØŸÑ Ÿáÿ∞ÿß ÿßŸÑŸÉŸàÿØ ÿ®ŸÉŸàÿØ ŸÖÿ¥ÿ±ŸàÿπŸÉ ŸÖŸÜ Firebase **
    const firebaseConfig = {
        apiKey: "AIzaSyDye4DgqNvEwwWDYf1yjW5yfJc14p1LmiU",
        authDomain: "your-project-10fbe.firebaseapp.com",
        databaseURL: "https://your-project-10fbe-default-rtdb.firebaseio.com",
        projectId: "your-project-10fbe",
        storageBucket: "your-project-10fbe.firebasestorage.app",

        messagingSenderId: "715972050011",
        appId: "1:715972050011:web:d5a4507dcfc30fa779d37e",
        measurementId: "G-D1FRL391R4"
    };
    
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const database = firebase.database();

    // Initialize Google Auth Provider
    const googleProvider = new firebase.auth.GoogleAuthProvider();
    googleProvider.addScope('profile');
    googleProvider.addScope('email');

    // Global Variables
    let projects = [];
    let currentProjectIndex = null;
    let currentDayIndex = null;
    let currentUser = null;

    // UI Elements
    const authPage = document.getElementById('authPage');
    const mainPage = document.getElementById('mainPage');
    const projectPage = document.getElementById('projectPage');
    const dayPage = document.getElementById('dayPage');
    const sharePage = document.getElementById('sharePage');
    const form = document.getElementById('auth-form');
    const formTitle = document.getElementById('form-title');
    const loginBtn = document.getElementById('login-btn');
    const signupBtn = document.getElementById('signup-btn');
    const toggleLink = document.getElementById('toggle-link');
    const toggleText = document.getElementById('toggle-text');
    const confirmPasswordGroup = document.getElementById('confirm-password-group');
    const successMsg = document.getElementById('success-msg');
    const errorMsg = document.getElementById('error-msg');
    const logoutBtn = document.getElementById('logout-btn');
    const userDisplayName = document.getElementById('user-display-name');
    const userDisplayEmail = document.getElementById('user-display-email');
    const forgotPasswordLink = document.getElementById('forgot-password-link'); 
    const googleLoginBtn = document.getElementById('google-login-btn');

    let isLoginMode = true;
    
    // Check for user login state
    auth.onAuthStateChanged(user => {
        if (handleShareLink()) {
            return;
        }
        
        if (user) {
            currentUser = user;
            showMainApp();
            loadProjects();
        } else {
            currentUser = null;
            hideAllPages();
            authPage.classList.remove('hidden');
        }
    });

    // Initial check for shared links
    handleShareLink();

    // Message functions
    function showSuccess(message) {
        successMsg.textContent = message;
        successMsg.style.display = 'block';
        errorMsg.style.display = 'none';
        setTimeout(() => {
            successMsg.style.display = 'none';
        }, 3000);
    }

    function showError(message) {
        errorMsg.textContent = message;
        errorMsg.style.display = 'block';
        successMsg.style.display = 'none';
        setTimeout(() => {
            errorMsg.style.display = 'none';
        }, 3000);
    }
    
    // Auth functions
    function toggleMode() {
        isLoginMode = !isLoginMode;
        if (isLoginMode) {
            formTitle.textContent = 'ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ';
            loginBtn.classList.remove('hidden');
            signupBtn.classList.add('hidden');
            confirmPasswordGroup.classList.add('hidden');

            if (forgotPasswordLink) forgotPasswordLink.style.display = 'block';
            if (googleLoginBtn) googleLoginBtn.style.display = 'flex';

            toggleText.innerHTML = 'ŸÑŸäÿ≥ ŸÑÿØŸäŸÉ ÿ≠ÿ≥ÿßÿ®ÿü <a href="#" id="toggle-link">ÿ•ŸÜÿ¥ÿßÿ° ÿ≠ÿ≥ÿßÿ® ÿ¨ÿØŸäÿØ</a>';
        } else {
            formTitle.textContent = 'ÿ•ŸÜÿ¥ÿßÿ° ÿ≠ÿ≥ÿßÿ® ÿ¨ÿØŸäÿØ';
            signupBtn.classList.remove('hidden');
            loginBtn.classList.add('hidden');
            confirmPasswordGroup.classList.remove('hidden');

            if (forgotPasswordLink) forgotPasswordLink.style.display = 'none';
            if (googleLoginBtn) googleLoginBtn.style.display = 'none';

            toggleText.innerHTML = 'ŸÑÿØŸäŸÉ ÿ≠ÿ≥ÿßÿ®ÿü <a href="#" id="toggle-link">ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ</a>';
        }

        const newToggleLink = document.getElementById('toggle-link');
        if (newToggleLink) {
            newToggleLink.addEventListener('click', function(e) {
                e.preventDefault();
                toggleMode();
            });
        }
    }

    function login(email, password) {
        auth.signInWithEmailAndPassword(email, password)
            .then((userCredential) => {
                showSuccess('ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ ÿ®ŸÜÿ¨ÿßÿ≠! üéâ');
            })
            .catch((error) => {
                const errorMessage = error.message;
                showError('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ. ÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä ŸàŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±.');
                console.error("Login error: ", errorMessage);
            });
    }

    // ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ ÿ®ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ Google
    function loginWithGoogle() {
        auth.signInWithPopup(googleProvider)
            .then((result) => {
                const user = result.user;
                // ÿ≠ŸÅÿ∏ ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ŸÅŸä ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
                database.ref('users/' + user.uid).set({
                    email: user.email,
                    name: user.displayName || user.email.split('@')[0],
                    photoURL: user.photoURL,
                    lastLogin: new Date().toISOString()
                }).then(() => {
                    showSuccess('ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ ÿ®ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ Google ÿ®ŸÜÿ¨ÿßÿ≠! üéâ');
                });
            })
            .catch((error) => {
                const errorCode = error.code;
                const errorMessage = error.message;
                
                if (errorCode === 'auth/popup-closed-by-user') {
                    showError('ÿ™ŸÖ ÿ•ŸÑÿ∫ÿßÿ° ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ');
                } else if (errorCode === 'auth/popup-blocked') {
                    showError('ÿ™ŸÖ ÿ≠ÿ∏ÿ± ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿßŸÑŸÖŸÜÿ®ÿ´ŸÇÿ©. Ÿäÿ±ÿ¨Ÿâ ÿßŸÑÿ≥ŸÖÿßÿ≠ ÿ®ÿßŸÑŸÜŸàÿßŸÅÿ∞ ÿßŸÑŸÖŸÜÿ®ÿ´ŸÇÿ© ŸàÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ© ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ');
                } else {
                    showError('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ ÿ®ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ Google');
                }
                console.error("Google login error: ", errorCode, errorMessage);
            });
    }

    function signup(email, password, confirmPassword) {
        if (password !== confirmPassword) {
            showError('ŸÉŸÑŸÖÿßÿ™ ÿßŸÑŸÖÿ±Ÿàÿ± ÿ∫Ÿäÿ± ŸÖÿ™ÿ∑ÿßÿ®ŸÇÿ© ‚ùå');
            return false;
        }
        if (password.length < 6) {
            showError('ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± Ÿäÿ¨ÿ® ÿ£ŸÜ ÿ™ŸÉŸàŸÜ 6 ÿ£ÿ≠ÿ±ŸÅ ÿπŸÑŸâ ÿßŸÑÿ£ŸÇŸÑ ‚ùå');
            return false;
        }

        auth.createUserWithEmailAndPassword(email, password)
            .then((userCredential) => {
                const user = userCredential.user;
                database.ref('users/' + user.uid).set({
                    email: email,
                    name: email.split('@')[0]
                }).then(() => {
                    showSuccess('ÿ™ŸÖ ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑÿ≠ÿ≥ÿßÿ® ÿ®ŸÜÿ¨ÿßÿ≠! üéâ ŸäŸÖŸÉŸÜŸÉ ÿßŸÑÿ¢ŸÜ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ');
                    setTimeout(() => {
                        toggleMode();
                        document.getElementById('email').value = email;
                    }, 1000);
                });
            })
            .catch((error) => {
                const errorMessage = error.message;
                if (errorMessage.includes("email-already-in-use")) {
                    showError('Ÿáÿ∞ÿß ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä ŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿ®ÿßŸÑŸÅÿπŸÑ ‚ùå');
                } else {
                    showError('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑÿ≠ÿ≥ÿßÿ®. ÿ≠ÿßŸàŸÑ ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ.');
                }
                console.error("Signup error: ", errorMessage);
            });
    }

    function resetPassword() {
        const email = document.getElementById("email").value;

        if (email) {
            auth.sendPasswordResetEmail(email)
                .then(() => {
                    alert("ÿ™ŸÖ ÿ•ÿ±ÿ≥ÿßŸÑ ÿ±ÿßÿ®ÿ∑ ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± ÿ•ŸÑŸâ ÿ®ÿ±ŸäÿØŸÉ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä. Ÿäÿ±ÿ¨Ÿâ ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑÿ®ÿ±ŸäÿØ ŸÅŸä ÿÆÿßŸÜÿ© ÿßŸÑÿ±ÿ≥ÿßÿ¶ŸÑ ÿßŸÑÿ∫Ÿäÿ± ŸÖÿ±ÿ∫Ÿàÿ® ÿ®Ÿáÿß .");
                })
                .catch((error) => {
                    let errorMessage = "ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£. Ÿäÿ±ÿ¨Ÿâ ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ© ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ.";
                    if (error.code === "auth/user-not-found") {
                        errorMessage = "Ÿáÿ∞ÿß ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä ÿ∫Ÿäÿ± ŸÖÿ≥ÿ¨ŸÑ. Ÿäÿ±ÿ¨Ÿâ ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä ŸàÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ© ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ.";
                    } else if (error.code === "auth/invalid-email") {
                        errorMessage = "ÿµŸäÿ∫ÿ© ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠ÿ©.";
                    }
                    alert(errorMessage);
                    console.error("Password reset error:", error);
                });
        } else {
            alert("Ÿäÿ±ÿ¨Ÿâ ÿ•ÿØÿÆÿßŸÑ ÿ®ÿ±ŸäÿØŸÉ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä ÿ£ŸàŸÑÿßŸã ŸÅŸä ÿßŸÑÿ≠ŸÇŸÑ ÿßŸÑŸÖÿÆÿµÿµ.");
        }
    }

    function hideAllPages() {
        authPage.classList.add('hidden');
        mainPage.classList.add('hidden');
        projectPage.classList.add('hidden');
        dayPage.classList.add('hidden');
        sharePage.classList.add('hidden');
    }

    function showMainApp() {
        hideAllPages();
        mainPage.classList.remove('hidden');
        userDisplayName.textContent = currentUser.displayName || currentUser.email.split('@')[0];
        userDisplayEmail.textContent = currentUser.email;
    }

    function logout() {
        auth.signOut()
            .then(() => {
                showSuccess('ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨ ÿ®ŸÜÿ¨ÿßÿ≠! üëã');
            })
            .catch((error) => {
                showError('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨.');
                console.error("Logout error: ", error);
            });
    }

    // Auth Event Listeners
    loginBtn.addEventListener('click', function() {
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        if (!email || !password) {
            showError('Ÿäÿ±ÿ¨Ÿâ ŸÖŸÑÿ° ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÖÿ∑ŸÑŸàÿ®ÿ© ‚ùå');
            return;
        }
        login(email, password);
    });

    signupBtn.addEventListener('click', function() {
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        const confirmPassword = document.getElementById('confirm-password').value;
        if (!email || !password) {
            showError('Ÿäÿ±ÿ¨Ÿâ ŸÖŸÑÿ° ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÖÿ∑ŸÑŸàÿ®ÿ© ‚ùå');
            return;
        }
        if (!isLoginMode && !confirmPassword) {
            showError('Ÿäÿ±ÿ¨Ÿâ ÿ™ÿ£ŸÉŸäÿØ ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± ‚ùå');
            return;
        }
        if (isLoginMode) {
            login(email, password);
        } else {
            signup(email, password, confirmPassword);
        }
    });

    toggleLink.addEventListener('click', function(e) {
        e.preventDefault();
        toggleMode();
    });

    logoutBtn.addEventListener('click', logout);

    // Google Login Event Listener
    googleLoginBtn.addEventListener('click', loginWithGoogle);

    form.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            e.preventDefault();
            if (isLoginMode) {
                loginBtn.click();
            } else {
                signupBtn.click();
            }
        }
    });

    // ========== Project Management Functions with Firebase ==========
    
    // Load projects from Firebase
    function loadProjects() {
        if (!currentUser) return;
        const projectsRef = database.ref(`projects/${currentUser.uid}`);
        
        projectsRef.on('value', snapshot => {
            const data = snapshot.val();
            projects = [];
            if (data) {
                projects = Object.keys(data).map(key => ({
                    id: key,
                    ...data[key]
                }));
            }
            renderProjects();
        });
    }

    // Save project data to Firebase
    function saveProject(projectData) {
        return new Promise((resolve, reject) => {
            if (!currentUser) {
                showError("ÿÆÿ∑ÿ£: ŸÑŸÖ Ÿäÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ.");
                return reject("No user logged in.");
            }
            const projectsRef = database.ref(`projects/${currentUser.uid}`);
            
            if (projectData.id) {
                const projectId = projectData.id;
                delete projectData.id;
                projectsRef.child(projectId).update(projectData).then(() => {
                    showSuccess("ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ ÿ®ŸÜÿ¨ÿßÿ≠!");
                    resolve();
                }).catch(error => {
                    console.error("Error updating project: ", error);
                    showError("ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ.");
                    reject(error);
                });
            } else {
                projectsRef.push(projectData).then(() => {
                    showSuccess("ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ ÿ®ŸÜÿ¨ÿßÿ≠!");
                    resolve();
                }).catch(error => {
                    console.error("Error adding new project: ", error);
                    showError("ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ.");
                    reject(error);
                });
            }
        });
    }
    
    // === ÿπÿ±ÿ∂ ÿßŸÑŸÖÿ¥ÿßÿ±Ÿäÿπ
    function renderProjects(){
        const list=document.getElementById("projectList"); 
        list.innerHTML="";
        if (projects.length === 0) {
            list.innerHTML = "<p>ŸÑÿß ŸäŸàÿ¨ÿØ ŸÖÿ¥ÿßÿ±Ÿäÿπ. ÿßÿ®ÿØÿ£ ÿ®ÿ•ÿ∂ÿßŸÅÿ© ŸÖÿ¥ÿ±Ÿàÿπ ÿ¨ÿØŸäÿØ!</p>";
            return;
        }
        projects.forEach((p,i)=>{
            let progress = Math.round(((p.days ? p.days.length : 0) / p.duration) * 100);
            
            let totalSpent = (p.payments || []).reduce((sum, pr) => sum + pr.amount, 0);
            let totalDayCost = (p.days || []).reduce((sum, d) => {
                const numbers = (d.costDetail || "").match(/\d+/g);
                if (numbers) {
                    return sum + numbers.reduce((daySum, num) => daySum + parseInt(num), 0);
                }
                return sum;
            }, 0);
            let grandTotal = totalDayCost;
            
            const div=document.createElement("div");
            div.className="project flex-between";
            div.innerHTML=`<b>${p.name}</b><span>üí∞ ${grandTotal.toLocaleString()} | üìä ${progress}%</span>`;
            div.onclick=()=>openProject(i);
            list.appendChild(div);
        });
    }

    function searchProjects(){
        const query=document.getElementById("searchInput").value.toLowerCase();
        const list=document.getElementById("projectList");
        list.innerHTML = "";
        
        const filteredProjects = projects.filter(p => p.name.toLowerCase().includes(query));

        if (filteredProjects.length === 0) {
            list.innerHTML = "<p>ŸÑÿß ŸäŸàÿ¨ÿØ ŸÖÿ¥ÿßÿ±Ÿäÿπ ÿ™ÿ∑ÿßÿ®ŸÇ ÿßŸÑÿ®ÿ≠ÿ´.</p>";
            return;
        }
        
        filteredProjects.forEach((p, i) => {
            let progress = Math.round(((p.days ? p.days.length : 0) / p.duration) * 100);
            let totalSpent = (p.payments || []).reduce((sum, pr) => sum + pr.amount, 0);
            let totalDayCost = (p.days || []).reduce((sum, d) => {
                const numbers = (d.costDetail || "").match(/\d+/g);
                if (numbers) {
                    return sum + numbers.reduce((daySum, num) => daySum + parseInt(num), 0);
                }
                return sum;
            }, 0);
            let grandTotal = totalSpent + totalDayCost;

            const div = document.createElement("div");
            div.className = "project flex-between";
            div.innerHTML = `<b>${p.name}</b><span>üí∞ ${grandTotal.toLocaleString()} | üìä ${progress}%</span>`;
            div.onclick = () => {
                const originalIndex = projects.findIndex(proj => proj.id === p.id);
                openProject(originalIndex);
            };
            list.appendChild(div);
        });
    }

    function showAddProject(){ 
        document.getElementById("addProjectForm").classList.remove("hidden"); 
    }

   function addProject() {
    let name = document.getElementById("projectName").value;
    let duration = parseInt(document.getElementById("projectDuration").value);
    let cost = parseInt(document.getElementById("projectCost").value);
    if (!name || !duration || !cost) {
        alert("ÿ£ÿØÿÆŸÑ ÿßŸÑÿ≠ŸÇŸàŸÑ ŸÉÿßŸÖŸÑÿ©");
        return;
    }

    const newProject = {
        name,
        duration,
        cost,
        startDate: new Date().toISOString().split("T")[0],
        days: [],
        payments: [],
        shareToken: Date.now().toString(36) + Math.random().toString(36).substr(2) // ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿ±ŸÖÿ≤ ŸáŸÜÿß
    };
    saveProject(newProject);

    document.getElementById("addProjectForm").classList.add("hidden");
    document.getElementById("projectName").value = "";
    document.getElementById("projectDuration").value = "";
    document.getElementById("projectCost").value = "";
}

    function editProject(){
        let p = projects[currentProjectIndex];
        let newName = prompt("‚úè ÿ™ÿπÿØŸäŸÑ ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ:", p.name);
        if(newName) p.name = newName;
        let newCost = prompt("‚úè ÿ™ÿπÿØŸäŸÑ ÿ™ŸÉŸÑŸÅÿ© ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ:", p.cost);
        if(newCost && !isNaN(newCost)) p.cost = parseInt(newCost);
        let newDuration = prompt("‚úè ÿ™ÿπÿØŸäŸÑ ŸÖÿØÿ© ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ ÿ®ÿßŸÑÿ£ŸäÿßŸÖ:", p.duration);
        if(newDuration && !isNaN(newDuration)) p.duration = parseInt(newDuration);
        
        saveProject(p).then(() => {
            openProject(currentProjectIndex);
        });
    }

    function deleteProject(){
        const projectsRef = database.ref(`projects/${currentUser.uid}`);
        projectsRef.child(projects[currentProjectIndex].id).remove().then(() => {
            showSuccess("ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ ÿ®ŸÜÿ¨ÿßÿ≠!");
            backToProjects();
        }).catch(error => {
            console.error("Error removing project: ", error);
            showError("ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ≠ÿ∞ŸÅ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ.");
        });
    }
    
    // === ŸÅÿ™ÿ≠ ŸÖÿ¥ÿ±Ÿàÿπ
    function openProject(i){
        currentProjectIndex = i;
        mainPage.classList.add("hidden");
        projectPage.classList.remove("hidden");
        let p = projects[i];
        document.getElementById("projTitle").innerText = p.name;
        let progress = Math.round(((p.days ? p.days.length : 0) / p.duration) * 100);
        let bar = document.getElementById("projProgress");
        bar.style.width = progress + "%";
        bar.innerText = progress + "%";
        let start = new Date(p.startDate);
        let end = new Date(start);
        end.setDate(start.getDate() + p.duration);
        let left = Math.max(0, Math.ceil((end - new Date()) / (1000 * 60 * 60 * 24)));
        document.getElementById("daysLeft").innerText = "‚è≥ ŸÖÿ™ÿ®ŸÇŸä " + left + " ŸäŸàŸÖ";
        document.getElementById("projCost").innerText = "üí∞ ÿßŸÑÿ™ŸÉŸÑŸÅÿ©: " + p.cost.toLocaleString();
        
        renderPayments();
        renderDays();
    }

    function backToProjects(){
        projectPage.classList.add("hidden");
        dayPage.classList.add("hidden");
        sharePage.classList.add("hidden");
        mainPage.classList.remove("hidden");
        renderProjects();
    }

    function backToProjectPageFromShare(){
        sharePage.classList.add("hidden");
        projectPage.classList.remove("hidden");
    }
    
    // === ÿßŸÑÿØŸÅÿπÿßÿ™
    function renderPayments(){
        let p = projects[currentProjectIndex];
        const list = document.getElementById("paymentsList");
        list.innerHTML = "";
        (p.payments || []).forEach((pay, index) => {
            const div = document.createElement("div");
            div.style.display = "flex";
            div.style.justifyContent = "space-between";
            div.style.alignItems = "center";
            div.style.marginBottom = "5px";
            div.innerHTML = `
                <span>üíµ ${pay.amount.toLocaleString()} | üìÖ ${pay.date}</span>
                <button class="delete">‚úñ</button>
            `;
            div.querySelector("button").onclick = () => {
                p.payments.splice(index, 1);
                saveProject(p).then(() => {
                    renderPayments();
                });
            };
            list.appendChild(div);
        });
    
        let totalPaid = (p.payments || []).reduce((sum, pr) => sum + pr.amount, 0);
        let remaining = p.cost - totalPaid;
        document.getElementById("remainingCost").innerText = "ÿßŸÑŸÖÿ™ÿ®ŸÇŸä: " + remaining.toLocaleString();
    }

    function addPayment(){
        let p = projects[currentProjectIndex];
        let amount = parseInt(prompt("üíµ ŸÖÿ®ŸÑÿ∫ ÿßŸÑÿØŸÅÿπÿ©:"));
        if(!amount || isNaN(amount)) return;
        let today = new Date().toISOString().split("T")[0];
        if(!p.payments) p.payments = [];
        p.payments.push({amount, date: today});
        saveProject(p).then(() => {
            renderPayments();
        });
    }

    // === ÿßŸÑÿ£ŸäÿßŸÖ
    function renderDays(){
        const list=document.getElementById("daysList");
        list.innerHTML="";
        let p=projects[currentProjectIndex];
        (p.days || []).forEach((d,i)=>{
            const div=document.createElement("div");
            div.className="day";
            div.innerHTML=`
                <div class="flex-between" onclick="toggleDayDetails(${i})">
                    <b>ÿßŸÑŸäŸàŸÖ ${i+1} - ${d.date} (${getDayName(d.date)})</b>
                    <span>‚¨á ÿßŸÑÿ™ŸÅÿßÿµŸäŸÑ</span>
                </div>
                <div id="details-${i}" class="day-details">
                    <table>
                        <tr><th>üî® ÿßŸÑÿπŸÖŸÑ</th><td>${(d.workDescription||"-").replace(/\n/g,"<br>")}</td></tr>
                        <tr><th>üë∑ ÿßŸÑŸÉÿßÿØÿ±</th><td>${(d.workersDetail||"-").replace(/\n/g,"<br>")}</td></tr>
                        <tr><th>üí∞ ÿßŸÑŸÖÿ®ÿßŸÑÿ∫</th><td>${(d.costDetail||"-").replace(/\n/g,"<br>")}</td></tr>
                    </table>
                    <div>
                        ${(d.media||[]).map((src,j)=>`<img src="${src}" onclick="openFullscreen('${src}')">`).join("")}
                    </div>
                    <button onclick="openDay(${i})">‚úè ÿ™ÿπÿØŸäŸÑ</button>
                    <button class="delete" onclick="deleteDay(${i});event.stopPropagation();">üóë ÿ≠ÿ∞ŸÅ ÿßŸÑŸäŸàŸÖ</button>
                </div>
            `;
            list.appendChild(div);
        });
    }

    function searchDays(){
        const query=document.getElementById("searchDayInput").value.toLowerCase();
        const list=document.getElementById("daysList");
        list.innerHTML="";
        const filteredDays = projects[currentProjectIndex].days.filter(d => {
            const dayString = JSON.stringify(d).toLowerCase();
            return dayString.includes(query);
        });

        if (filteredDays.length === 0) {
            list.innerHTML = "<p>ŸÑÿß ŸäŸàÿ¨ÿØ ÿ£ŸäÿßŸÖ ÿ™ÿ∑ÿßÿ®ŸÇ ÿßŸÑÿ®ÿ≠ÿ´.</p>";
            return;
        }

        filteredDays.forEach((d, i) => {
            const originalIndex = projects[currentProjectIndex].days.findIndex(day => day === d);
            const div = document.createElement("div");
            div.className = "day";
            div.innerHTML=`
                <div class="flex-between" onclick="toggleDayDetails(${originalIndex})">
                    <b>ÿßŸÑŸäŸàŸÖ ${originalIndex+1} - ${d.date} (${getDayName(d.date)})</b>
                    <span>‚¨á ÿßŸÑÿ™ŸÅÿßÿµŸäŸÑ</span>
                </div>
                <div id="details-${originalIndex}" class="day-details">
                    <table>
                        <tr><th>üî® ÿßŸÑÿπŸÖŸÑ</th><td>${(d.workDescription||"-").replace(/\n/g,"<br>")}</td></tr>
                        <tr><th>üë∑ ÿßŸÑŸÉÿßÿØÿ±</th><td>${(d.workersDetail||"-").replace(/\n/g,"<br>")}</td></tr>
                        <tr><th>üí∞ ÿßŸÑŸÖÿ®ÿßŸÑÿ∫</th><td>${(d.costDetail||"-").replace(/\n/g,"<br>")}</td></tr>
                    </table>
                    <div>
                        ${(d.media||[]).map(src=>`<img src="${src}" onclick="openFullscreen('${src}')">`).join("")}
                    </div>
                    <button onclick="openDay(${originalIndex})">‚úè ÿ™ÿπÿØŸäŸÑ</button>
                    <button class="delete" onclick="deleteDay(${originalIndex});event.stopPropagation();">üóë ÿ≠ÿ∞ŸÅ ÿßŸÑŸäŸàŸÖ</button>
                </div>
            `;
            list.appendChild(div);
        });
    }
    
    // === ÿ™ŸÅÿßÿµŸäŸÑ ÿßŸÑŸäŸàŸÖ + ÿßŸÑÿµŸàÿ±
    function toggleDayDetails(i){ 
        let el=document.getElementById("details-"+i); 
        el.style.display=el.style.display==="block"?"none":"block"; 
    }

    function getDayName(dateStr){ 
        const days=["ÿßŸÑÿ£ÿ≠ÿØ","ÿßŸÑÿßÿ´ŸÜŸäŸÜ","ÿßŸÑÿ´ŸÑÿßÿ´ÿßÿ°","ÿßŸÑÿ£ÿ±ÿ®ÿπÿßÿ°","ÿßŸÑÿÆŸÖŸäÿ≥","ÿßŸÑÿ¨ŸÖÿπÿ©","ÿßŸÑÿ≥ÿ®ÿ™"]; 
        return days[new Date(dateStr).getDay()]; 
    }

    function addDay(){ 
        let p = projects[currentProjectIndex];
        let today = new Date().toISOString().split("T")[0]; 
        if (!p.days) p.days = [];
        p.days.push({date:today,workDescription:"",workersDetail:"",costDetail:"",media:[]}); 
        saveProject(p).then(() => { renderDays(); });
    }

    function deleteDay(i){ 
        if(confirm("ŸáŸÑ ÿ™ÿ±ŸäÿØ ÿ≠ÿ∞ŸÅ Ÿáÿ∞ÿß ÿßŸÑŸäŸàŸÖÿü")){ 
            let p = projects[currentProjectIndex];
            p.days.splice(i,1); 
            saveProject(p).then(() => { 
                renderDays();
            });
        } 
    }

    function openDay(i){ 
        currentDayIndex = i; 
        projectPage.classList.add("hidden"); 
        dayPage.classList.remove("hidden"); 
        let d = projects[currentProjectIndex].days[i]; 
        document.getElementById("dayDate").innerText = "üìÖ " + d.date + " (" + getDayName(d.date) + ")"; 
        document.getElementById("workDescription").value = d.workDescription || ""; 
        document.getElementById("workersDetail").value = d.workersDetail || ""; 
        document.getElementById("costDetail").value = d.costDetail || ""; 
        renderMedia(); 
    }

    function backToProject(){ 
        dayPage.classList.add("hidden"); 
        projectPage.classList.remove("hidden"); 
        renderDays(); 
    }

    function saveDay(){ 
        let p = projects[currentProjectIndex];
        let d = p.days[currentDayIndex];
        d.workDescription = document.getElementById("workDescription").value; 
        d.workersDetail = document.getElementById("workersDetail").value; 
        d.costDetail = document.getElementById("costDetail").value; 
        
        let files = document.getElementById("mediaInput").files;
        if (files.length === 0) {
            saveProject(p).then(() => {
                renderMedia();
                alert("ÿ™ŸÖ ÿßŸÑÿ≠ŸÅÿ∏!");
            });
            return;
        }

        let filesProcessed = 0;
        for (let f of files) {
            let reader = new FileReader();
            reader.onload = function(e) {
                let img = new Image();
                img.onload = function() {
                    let canvas = document.createElement('canvas');
                    let ctx = canvas.getContext('2d');
                    let maxWidth = 800;
                    let maxHeight = 600;
                    let ratio = Math.min(maxWidth / img.width, maxHeight / img.height);
                    canvas.width = img.width * ratio;
                    canvas.height = img.height * ratio;
                    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                    let compressedData = canvas.toDataURL('image/jpeg', 0.6);
                    if (!d.media) d.media = [];
                    d.media.push(compressedData);
                    filesProcessed++;
                    if (filesProcessed === files.length) {
                        saveProject(p).then(() => {
                            renderMedia();
                        });
                    }
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(f);
        }
    }

    function renderMedia(){ 
        let d=projects[currentProjectIndex].days[currentDayIndex]; 
        let container=document.getElementById("mediaList"); 
        container.innerHTML=""; 
        (d.media || []).forEach((src,j)=>{ 
            let div=document.createElement("div"); 
            div.style.display="inline-block"; 
            div.style.position="relative"; 
            let img=document.createElement("img"); 
            img.src=src; 
            img.onclick=()=>openFullscreen(src); 
            let del=document.createElement("button"); 
            del.innerText="x"; 
            del.className="delete"; 
            del.style.position="absolute"; 
            del.style.top="0"; 
            del.style.right="0"; 
            del.onclick=(event)=>{
                event.stopPropagation();
                if (confirm("ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ≠ÿ∞ŸÅ Ÿáÿ∞Ÿá ÿßŸÑÿµŸàÿ±ÿ©ÿü")) {
                    deleteImage(currentDayIndex,j);
                }
            }; 
            div.appendChild(img); 
            div.appendChild(del); 
            container.appendChild(div); 
        }); 
    }

    function deleteImage(dayIndex,imgIndex){ 
        let p = projects[currentProjectIndex];
        let d = p.days[dayIndex];
        d.media.splice(imgIndex,1); 
        saveProject(p).then(() => { 
            if(dayIndex===currentDayIndex) renderMedia(); 
        });
    }

    function openFullscreen(src){ 
        let fs=document.createElement("div"); 
        fs.className="fullscreen"; 
        let img=document.createElement("img"); 
        img.src=src; 
        fs.appendChild(img); 
        fs.onclick=()=>fs.remove(); 
        document.body.appendChild(fs); 
    }
    
    // === ŸÖÿ¥ÿßÿ±ŸÉÿ© ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ
   // This is the function you should use for sharing
function shareProject() {
    const shareOption = prompt("ÿßÿÆÿ™ÿ± ŸÜŸàÿπ ÿßŸÑŸÖÿ¥ÿßÿ±ŸÉÿ©:\n1. ŸÖÿ¥ÿßÿ±ŸÉÿ© ÿ¨ŸÖŸäÿπ ÿßŸÑÿ£ŸäÿßŸÖ\n2. ŸÖÿ¥ÿßÿ±ŸÉÿ© ÿ£ŸäÿßŸÖ ŸÖÿπŸäŸÜÿ©");
    let projectToShare = projects[currentProjectIndex];
    
    if (shareOption === "1") {
        let shareLink = window.location.origin + window.location.pathname + `?shareToken=${projectToShare.shareToken}`;
        prompt("ÿßŸÜÿ≥ÿÆ ÿßŸÑÿ±ÿßÿ®ÿ∑ ŸÑŸÖÿ¥ÿßÿ±ŸÉÿ© ÿ¨ŸÖŸäÿπ ÿßŸÑÿ£ŸäÿßŸÖ:", shareLink);
    } else if (shareOption === "2") {
        showDaySelectionPopup();
    } else {
        return;
    }
}

   function showDaySelectionPopup() {
    let popupContainer = document.createElement("div");
    popupContainer.style.cssText = "position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); display: flex; align-items: center; justify-content: center; z-index: 1000;";

    let popupContent = document.createElement("div");
    popupContent.style.cssText = "background: #fff; padding: 20px; border-radius: 12px; width: 90%; max-width: 400px; max-height: 80vh; overflow-y: auto; text-align: right; direction: rtl;";

    let title = document.createElement("h3");
    title.innerText = "ÿßÿÆÿ™ÿ± ÿßŸÑÿ£ŸäÿßŸÖ ŸÑŸÑŸÖÿ¥ÿßÿ±ŸÉÿ©:";
    popupContent.appendChild(title);

    let currentProject = projects[currentProjectIndex];
    if (currentProject && currentProject.days) {
        currentProject.days.forEach((day, index) => {
            let dayDiv = document.createElement("div");
            dayDiv.style.cssText = "margin-bottom: 10px;";

            let checkbox = document.createElement("input");
            checkbox.type = "checkbox";
            checkbox.id = "day-" + index;
            checkbox.style.marginLeft = "10px";

            let label = document.createElement("label");
            label.htmlFor = "day-" + index;
            label.innerText = `ÿßŸÑŸäŸàŸÖ ${index + 1} - ${day.date}`;

            dayDiv.appendChild(checkbox);
            dayDiv.appendChild(label);
            popupContent.appendChild(dayDiv);
        });
    }

    let buttonDiv = document.createElement("div");
    buttonDiv.style.cssText = "display: flex; justify-content: space-around; margin-top: 20px;";

    let shareBtn = document.createElement("button");
    shareBtn.innerText = "ÿ•ŸÜÿ¥ÿßÿ° ÿ±ÿßÿ®ÿ∑ ÿßŸÑŸÖÿ¥ÿßÿ±ŸÉÿ©";
    shareBtn.style.backgroundColor = "#2ecc71";
    shareBtn.onclick = () => {
        let selectedIndices = [];
        popupContent.querySelectorAll("input[type='checkbox']").forEach((checkbox, index) => {
            if (checkbox.checked) {
                selectedIndices.push(index);
            }
        });

        if (selectedIndices.length > 0) {
            let daysString = selectedIndices.join(',');
            let shareLink = window.location.origin + window.location.pathname + `?shareToken=${currentProject.shareToken}&days=${daysString}`;
            prompt("ÿßŸÜÿ≥ÿÆ ÿßŸÑÿ±ÿßÿ®ÿ∑ ŸÑŸÖÿ¥ÿßÿ±ŸÉÿ© ÿßŸÑÿ£ŸäÿßŸÖ ÿßŸÑŸÖÿ≠ÿØÿØÿ©:", shareLink);
        } else {
            alert("ŸÑŸÖ Ÿäÿ™ŸÖ ÿßÿÆÿ™Ÿäÿßÿ± ÿ£Ÿä ŸäŸàŸÖ.");
        }
        popupContainer.remove();
    };

    let cancelBtn = document.createElement("button");
    cancelBtn.innerText = "ÿ•ŸÑÿ∫ÿßÿ°";
    cancelBtn.style.backgroundColor = "#e74c3c";
    cancelBtn.onclick = () => {
        popupContainer.remove();
    };

    buttonDiv.appendChild(shareBtn);
    buttonDiv.appendChild(cancelBtn);
    popupContent.appendChild(buttonDiv);

    popupContainer.appendChild(popupContent);
    document.body.appendChild(popupContainer);
}

    function renderSharePage(projectData) {
        mainPage.classList.add("hidden");
        projectPage.classList.add("hidden");
        dayPage.classList.add("hidden");
        sharePage.classList.remove("hidden");

        document.getElementById("shareProjTitle").innerText = projectData.name;

        let progress = Math.round(((projectData.days ? projectData.days.length : 0) / projectData.duration) * 100);
        if(progress > 100) progress = 100;
        let bar = document.getElementById("shareProjProgress");
        bar.style.width = progress + "%";
        bar.innerText = progress + "%";

        let start=new Date(projectData.startDate);
        let end=new Date(start);
        end.setDate(start.getDate()+projectData.duration);
        let left=Math.max(0,Math.ceil((end-new Date())/(1000*60*60*24)));
        document.getElementById("shareDaysLeft").innerText="‚è≥ ŸÖÿ™ÿ®ŸÇŸä "+left+" ŸäŸàŸÖ";
        document.getElementById("shareProjCost").innerText="üí∞ ÿßŸÑÿ™ŸÉŸÑŸÅÿ©: "+(projectData.cost || 0).toLocaleString();

        const paymentsList = document.getElementById("sharePaymentsList");
        paymentsList.innerHTML = (projectData.payments || []).map(pay => `<div>üíµ ${pay.amount.toLocaleString()} | üìÖ ${pay.date}</div>`).join("") || "ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿØŸÅÿπÿßÿ™ ŸÖÿ≥ÿ¨ŸÑÿ©.";

        const daysList = document.getElementById("shareDaysList");
        daysList.innerHTML = "";
        (projectData.days || []).forEach((d,i)=>{
            const div = document.createElement("div");
            div.className = "day";
            div.innerHTML=`
                <b>ÿßŸÑŸäŸàŸÖ ${i+1} - ${d.date} (${getDayName(d.date)})</b>
                <table>
                    <tr><th>üî® ÿßŸÑÿπŸÖŸÑ</th><td>${(d.workDescription||"-").replace(/\n/g,"<br>")}</td></tr>
                    <tr><th>üë∑ ÿßŸÑŸÉÿßÿØÿ±</th><td>${(d.workersDetail||"-").replace(/\n/g,"<br>")}</td></tr>
                    <tr><th>üí∞ ÿßŸÑŸÖÿ®ÿßŸÑÿ∫</th><td>${(d.costDetail||"-").replace(/\n/g,"<br>")}</td></tr>
                </table>
                <div>${(d.media||[]).map(src=>`<img src="${src}" onclick="openFullscreen('${src}')">`).join("")}</div>
            `;
            daysList.appendChild(div);
        });
    }

  // Function to handle shared project links
function handleShareLink() {
    const urlParams = new URLSearchParams(window.location.search);
    const sharedToken = urlParams.get('shareToken');
    const sharedDays = urlParams.get('days');

    if (sharedToken) {
        // ÿßŸÑÿ®ÿ≠ÿ´ ÿπŸÜ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ ÿ®ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑÿ™ŸàŸÉŸÜ ŸÖŸÜ ÿÆŸÑÿßŸÑ ŸÖÿ≥ÿßÿ± "shareProjects"
        database.ref('shareProjects').orderByChild('shareToken').equalTo(sharedToken).once('value').then(snapshot => {
            const projectData = snapshot.val();
            if (projectData) {
                const foundProject = Object.values(projectData)[0]; // get the first object
                
                if (sharedDays) {
                    const daysIndices = sharedDays.split(',').map(Number);
                    foundProject.days = foundProject.days.filter((day, index) => daysIndices.includes(index));
                }

                hideAllPages();
                renderSharePage(foundProject);
            } else {
                alert("ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ ÿ∫Ÿäÿ± ŸÖŸàÿ¨ŸàÿØ. ÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿµÿ≠ÿ© ÿßŸÑÿ±ÿßÿ®ÿ∑.");
                window.location.href = window.location.origin + window.location.pathname;
            }
        }).catch(error => {
            console.error("Error fetching shared project:", error);
            alert("ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ.");
            window.location.href = window.location.origin + window.location.pathname;
        });
        return true;
    }
    return false;
}
    // üåô Ÿàÿ∏ÿßÿ¶ŸÅ ÿßŸÑŸàÿ∂ÿπ ÿßŸÑŸÑŸäŸÑŸä
    document.addEventListener('DOMContentLoaded', (event) => {
        const darkModeToggle = document.getElementById('darkModeToggle');
        const prefersDarkScheme = window.matchMedia("(prefers-color-scheme: dark)");

        const currentTheme = localStorage.getItem("theme");
        if (currentTheme === "dark") {
            document.body.classList.add("light-mode");
        } else if (currentTheme === "light") {
            document.body.classList.remove("light-mode");
        } else if (prefersDarkScheme.matches) {
            document.body.classList.remove("light-mode");
        } else {
            document.body.classList.add("light-mode");
        }
        
        function updateDarkModeIcon() {
            if (document.body.classList.contains("light-mode")) {
                darkModeToggle.innerHTML = '<i class="fas fa-sun"></i>';
            } else {
                darkModeToggle.innerHTML = '<i class="fas fa-moon"></i>';
            }
        }
        
        updateDarkModeIcon();

        darkModeToggle.addEventListener('click', () => {
            document.body.classList.toggle("light-mode");
            if (document.body.classList.contains("light-mode")) {
                localStorage.setItem("theme", "dark");
            } else {
                localStorage.setItem("theme", "light");
            }
            updateDarkModeIcon();
        });
    });

</script>

</body>
</html>


